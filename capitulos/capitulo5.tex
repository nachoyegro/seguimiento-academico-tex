\chapter{Pruebas realizadas}
\label{sec:implementacion}

\section[Pruebas y resultados]{Pruebas y resultados}

\subsection[Resultados esperados]{Resultados esperados}

Se espera con este desarrollo tener un sistema capaz de brindarle datos a todos los interesados. Para que esto se cumpla, la implementación tiene que ser capaz de manejar todos los pedidos que recibe y responder en consecuencia. 
Si bien la problemática inicial implica que sólo se consultarán datos para analizarlos y ser visualizados por los directores de las carreras de la Universidad Nacional de Quilmes, no hay que descartar que pueda ser extendido dado su potencial.
Para garantizar que todo funcione de manera correcta se realizaron diferentes pruebas con escenarios cambiantes.
Para todas las pruebas se usaron los mismos URIs y se realizaron sobre una base de datos con 1.424 alumnos y 13.234 materias cursadas por estos alumnos.
La arquitectura utilizada para las pruebas se asemeja a la que dispondrá a la hora de la implementación.

Para medir los tiempos de respuesta, se usará APDEX.

APDEX (Índice de Performance de la Aplicación, por sus siglas en inglés) es un estandard abierto para medir la performance de una a aplicación de software. Su propósito es convertir las mediciones en información sobre la satisfacción del usuario, al especificar una forma uniforme de analizar e informar sobre el grado en que el rendimiento medido cumple con las expectativas del usuario.
Para realizar una medición APDEX, es necesario establecer un tiempo \emph{satisfactorio} y un tiempo \emph{tolerable}.
Una vez establecidos estos valores y tendo los resultados de la prueba, se calcula el índice:

\begin{align*}
  Apdex = \frac{Satisfactorios + \frac{Tolerables}{2}}{Total}\\
\end{align*}

\break
\subsection{Pruebas con 100 usuarios simultáneos}
En primer lugar, se realizó una prueba en la cual 100 usuarios simultáneos se encuentran haciendo pedidos al núcleo, el cual está desplegado en una sola instancia de docker.
Esta prueba duró 5 minutos y los resultados se muestran a continuación.


\subsubsection{Resultados generales de la prueba}
\begin{table}[!htbp]
    \centering
    \makegapedcells
    \begin{tabular}{|c|c|c|c|}
    \hline
    Nombre del Pedido & Cantidad & Errores (\%) & Tiempo Promedio (ms) \\ \hline
    Total & 16977 & 0.00\% & 1043.79\\ \hline
    Carrera | graduados & 2834 & 0.00\% & 1038.98\\ \hline
    Carrera | ingresantes & 2871 & 0.00\% & 1057.51\\ \hline
    Carrera | postulantes & 2850 & 0.00\% & 1046.61\\ \hline
    Carreras & 2793 & 0.00\% & 1851.00\\ \hline
    Plan | Materias necesarias & 5629 & 0.00\% & 1036.10\\ \hline
    
    \end{tabular}
    \caption{Pruebas realizadas con 100 usuarios simultáneos durante 5 minutos}
    \label{tab:tabla_planes}
\end{table}

\subsubsection{Resultados sobre el uso de recursos durate la prueba}
\begin{table}[!htbp]
    \centering
    \makegapedcells
    \begin{tabular}{|c|c|c|}
    \hline
    Contenedor & CPU & Memoria (MB)\\ \hline
    Núcleo & 68\% & 55 \\ \hline
    \end{tabular}
    \caption{Recursos en promedio consumidos por el contenedor durante la prueba}
    \label{tab:tabla_planes}
\end{table}

En promedio utilizó un 68\% del CPU y 55MB de memoria RAM.


\subsubsection{APDEX de la prueba}
\begin{table}[!htbp]
    \centering
    \makegapedcells
    \begin{tabular}{|c|c|c|}
    \hline
    APDEX Total & Tolerancia & Frustración\\ \hline
    0.995 & 2 seg & 3 seg \\ \hline
    \end{tabular}
    \caption{APDEX de la prueba con 100 usuarios durante 5 minutos}
    \label{tab:tabla_planes}
\end{table}

\break

\subsection{Pruebas con 300 usuarios simultáneos}
Luego de la primer prueba, se realizó una segunda en la cual 300 usuarios simultáneos se encuentran haciendo pedidos al núcleo, el cual está desplegado en una sola instancia de docker.
Esta prueba duró 10 minutos y los resultados se muestran a continuación.

\subsubsection{Resultados generales de la prueba}
\begin{table}[!htbp]
    \centering
    \makegapedcells
    \begin{tabular}{|c|c|c|c|}
    \hline
    Nombre del Pedido & Cantidad & Errores (\%) & Tiempo Promedio (ms) \\ \hline
    Total & 20918 & 1.37\% & 4409.80\\ \hline
    Carrera | Cantidad graduados & 4175 & 1.20\% & 4242.01\\ \hline
    Carrera | Cantidad ingresantes & 4309 & 1.25\% & 4461.21\\ \hline
    Carrera | Cantidad postulantes & 4242 & 1.65\% & 4641.71\\ \hline
    Carreras & 4070 & 1.25\% & 4274.56\\ \hline
    Plan | Cantidad materias necesarias & 4122 & 1.50\% & 4420.89\\ \hline
    \end{tabular}
    \caption{Pruebas realizadas con 300 usuarios simultáneos durante 10 minutos}
    \label{tab:tabla_planes}
\end{table}



\subsubsection{Resultados sobre el uso de recursos durante la prueba}
\begin{table}[!htbp]
    \centering
    \makegapedcells
    \begin{tabular}{|c|c|c|}
    \hline
    Contenedor & CPU & Memoria (MB)\\ \hline
    Núcleo & 88\% & 55 \\ \hline
    \end{tabular}
    \caption{Recursos en promedio consumidos por el contenedor durante la prueba}
    \label{tab:tabla_planes}
\end{table}

\subsubsection{APDEX de la prueba}
\begin{table}[!htbp]
    \centering
    \makegapedcells
    \begin{tabular}{|c|c|c|}
    \hline
    APDEX Total & Tolerancia & Frustración\\ \hline
    0.361 & 2 seg & 3 seg \\ \hline
    \end{tabular}
    \caption{APDEX de la prueba con 300 usuarios durante 10 minutos y una instancia de la aplicación}
    \label{tab:tabla_planes}
\end{table}


\subsection{Pruebas con 300 usuarios simultáneos con dos instancias}
Luego de la prueba anterior, donde se refleja una baja considerable del tiempo de respuesta al recibir esa magnitud de usuarios simultáneos, se realizó la misma prueba haciendo uso del balanceador de carga y agregando otra instancia de docker.
Esta prueba duró 10 minutos y los resultados se muestran a continuación.

\subsubsection{Resultados generales de la prueba}
\begin{table}[!htbp]
    \centering
    \makegapedcells
    \begin{tabular}{|c|c|c|c|}
    \hline
    Nombre del Pedido & Cantidad & Errores (\%) & Tiempo Promedio (ms) \\ \hline
    Total & 33499 & 0.02\% & 2796.50\\ \hline
    Carrera | Cantidad graduados & 6691 & 0.01\% & 2844.47\\ \hline
    Carrera | Cantidad ingresantes & 6828 & 0.04\% & 2709.15\\ \hline
    Carrera | Cantidad postulantes & 6756 & 0.04\% & 2945.30\\ \hline
    Carreras & 6584 & 0.02\% & 2782.27\\ \hline
    Plan | Cantidad materias necesarias & 6640 & 0.00\% & 2700.69\\ \hline
    \end{tabular}
    \caption{Pruebas realizadas con 300 usuarios simultáneos durante 10 minutos}
    \label{tab:tabla_planes}
\end{table}



\subsubsection{Resultados sobre el uso de recursos durate la prueba}
\begin{table}[!htbp]
    \centering
    \makegapedcells
    \begin{tabular}{|c|c|c|}
    \hline
    Contenedor & CPU & Memoria (MB)\\ \hline
    Núcleo-1 & 67\% & 54 \\ \hline
    Núcleo-2 & 68\% & 54 \\ \hline
    \end{tabular}
    \caption{Recursos en promedio consumidos por los contenedores durante la prueba}
    \label{tab:tabla_planes}
\end{table}
\subsubsection{APDEX de la prueba}
\begin{table}[!htbp]
    \centering
    \makegapedcells
    \begin{tabular}{|c|c|c|}
    \hline
    APDEX Total & Tolerancia & Frustración\\ \hline
    0.667 & 2 seg & 3 seg \\ \hline
    \end{tabular}
    \caption{APDEX de la prueba con 300 usuarios durante 10 minutos y dos instancias de la aplicación}
    \label{tab:tabla_planes}
\end{table}
\break
\section{Conclusiones sobre las pruebas}

Luego de realizar diferentes pruebas al núcleo, se observa que con 100 usuarios simultáneos haciendo requests constantes durante 5 minutos, llegando a un total de 16977 pedidos, la aplicación respondió a la perfección llegando a un APDEX de 0.995 y 0\% de errores.

Después, se planteó un escenario donde 300 usuarios simultáneos realizaron requests constantes durante 10 minutos (20918 pedidos) y se pudo observar una baja considerable del APDEX llegando a 0.361. Los errores también aumentaron llegando a 1.37\%. 

Por último, y con motivo de mejorar los resultados para una mejor experiencia de los usuarios, se realizó la misma prueba duplicando las instancias de docker y haciendo uso del balanceador de carga de Nginx. Los resultados mejoraron notablemente llegando a un APDEX de 0.667 y bajando los errores a 0.02\%. Además, se incrementó la cantidad de pedidos que resolvió en ese tiempo, llevandolos a 33499 (un 60.1\% más).

Teniendo en cuenta que en la UNQ los momentos en que los sistemas académicos son mas exigidos es en el inicio y en el final de los cuatrimestres, se podría duplicar las instancias de docker en estos momentos (o triplicar, de ser necesario).
